# 2. 无线传输（Radio Transmission）
对于任何熟悉无线接入技术（如Wi-Fi）的人来说，蜂窝网络最独特的地方在于它可以在众多用户之间共享可用的无线电频谱，同时允许这些用户在移动时保持连接。这就产生了一种高度动态和自适应的方法，其中编码、调制和调度起着核心作用。

正如我们将在本章中看到的，蜂窝网络使用基于预留（reservation-based）的策略，而Wi-Fi则是基于竞争（contention-based）。这种差异根源于每个系统对利用率的基本假设：Wi-Fi假定网络负载较轻（因此在无线链路空闲时尽量进行传输，在检测到竞争时退出），而4G/5G蜂窝网络假定（并争取）高利用率（因此明确的将可用无线电频谱的不同“份额”分配给不同用户共享使用）。

首先，我们简要介绍一下无线传输，为理解5G架构的其余部分打下基础。以下内容并不是对该主题的理论介绍，而是为接下来介绍5G无线通信系统的实现奠定基础。

## 2.1. 编码与调制（Coding and Modulation）
移动通信信道要实现可靠的数字数据传输，需要克服许多危害，包括噪声、衰减、失真、衰落和干扰。这个挑战是通过编码和调制的组合来解决的，如图1所示。

![图1. 编码和调制在移动通信中的作用。](https://upload-images.jianshu.io/upload_images/15825758-d4f89cccd0d8bd39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

编码的核心是在数据中插入额外的比特，以帮助从所有干扰信号传播的环境因素中恢复数据。这通常意味着某种形式的*FEC（Forward Error Correction， 前向错误纠正）*(例如，turbo码，极坐标码)。调制产生代表编码数据流的信号，并且适配对应的信道参数：首先，基于可观测信道干扰，使用某个数字调制信号格式最大化每秒可靠传输的比特数量；其次，使用脉冲整形匹配传输带宽和信道带宽；最后，使用射频调制将信号转换为电磁波，在指定的*载波频率（carrier frequency）*上传输。

为了更深入地了解通过空气传播无线电信号从而进行可靠数据传输所面临的挑战，请考虑图2中所描述的场景，其中信号从各种静止和移动的物体表面反射，从发射端到接收端可能有多条传输路径，并且两端可能都在移动中。

![图2. 信号从发射机到接收机沿着多条路径传播。](https://upload-images.jianshu.io/upload_images/15825758-2885dc98a527f65f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

作为多径传输的结果，原始信号到达接收端后会随着时间扩散，如图3所示。经验证据表明，在城市环境中，多径扩展（Multipath Spread，即一次传输的第一个和最后一个信号到达接收端的时间）为1-10μs，在郊区环境中为10-30μs。这些多路径信号可能会互相干扰，从而使得信号增强或减弱，而且这种干扰会随着时间而变化。在一定的时间内，可以假定信道是不变的，这一理论界限被称为相干时间，记为$T_c$，由下式计算得出：$T_c=c/v\times1/f$。其中$c$为信号的速度，$v$为接收端的运动速度（例如，移动的汽车或火车），$f$为被调制的载波信号的频率。这说明相干时间与信号的频率和运动速度成反比，这很直观：频率越高（波长越短）相干时间越短，同样，接收端运动越快相干时间越短。根据该模型的目标参数（基于目标物理环境选择），可以计算$T_c$，从而限制信号在不存在过度干扰风险的情况下可以传输的速率。无线信道的动态特性是蜂窝网络中需要解决的主要问题之一。

![图3. 由于多径传输，接收到的数据会随时间扩散。](https://upload-images.jianshu.io/upload_images/15825758-de25c9ead2d4896e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

更复杂的是，图2和图3暗示传输来自单个天线，但蜂窝基站配备了天线阵列，每个天线在不同的（但有重叠的）方向上发射。这种技术被称为*MIMO（Multiple-Input-Multiple-Output，多输入多输出）*，它在环境造成的多径传输的基础上增加了更多的路径，有意识的在接收端之间通过从多个路径传输数据。

这样造成的结果是，发送端必须从每个接收端接收反馈，以判断如何最好地利用无线资源为他们服务。3GPP为此定义了*CQI（Channel Quality Indicator，信道质量指示器）*。在实际操作中，接收端定期（例如，在LTE中是每1 ms）向基站发送一个CQI状态报告。这些CQI消息上报观测到的信噪比，信噪比会影响接收端恢复数据的能力。然后，基站利用这些信息调整如何将可用的无线电频谱分配给它所服务的用户，以及采用哪种编码和调制方案。所有这些决定都是由调度器做出的。

## 2.2. 调度器
每一代蜂窝网络最重要的特性之一就是调度器如何完成它的工作，而这又取决于多路复用机制。例如，2G使用*TDMA（Time Division Multiple Access，时分多址）*， 3G使用*CDMA（Code Division Multiple Access，码分多址）*。数据如何复用也是4G和5G的一个主要区别，它完成了从基本电路交换到基本分组交换蜂窝网络的过渡。

4G和5G都基于*OFDM（Orthogonal Frequency-Division Multiplexing，正交频分复用）*，即在多个正交子载波频率上复用数据，每个子载波都是独立调制的。OFDM的价值和效率在于如何选择子载波频率以避免干扰，即如何实现正交性。这个话题超出了这本书的范围。相反，我们采取了一个非常抽象的多路复用的观点，专注于“无线频谱的离散可调度单元”，而不是产生这些可调度单元的信号和调制机制。

首先，我们深入研究这些可调度单元。在最后一节，我们回到更广泛的问题，即有效利用频谱的*空中接口*。

### *4G中的多路复用*
4G下行传输多路复用技术被称为*OFDMA（Orthogonal Frequency-Division Multiple Access，正交频分多址）*，这是OFDM的一种特殊应用，它将数据在一组12个正交子载波频率上复用，每个子载波频率都是独立调制的<sup>注1</sup>。OFDMA中的“多址接入”意味着可以代表多个用户同时发送数据，每个用户使用不同的子载波频率和不同的时间段。子频带很窄（例如15kHz），但将用户数据编码为OFDMA符号的设计是为了将相邻频带之间的干扰造成的数据丢失风险降至最低。

> 注1：
> 对于上行传输（从用户设备到基站），4G使用了不同的多路复用策略，但5G使用了不同的方法，所以我们不打算在这里描述。

OFDMA的使用自然而然的导致了将无线电频谱概念转化为2-D资源，如图4所示。最小可调度单元，称为*RE（Resource Element，资源单元）*，对应于一个副载波频率周围的15kHz频带和传输一个OFDMA符号所需的时间。每个符号可以编码的比特数取决于调制速率，例如使用*QAM（Quadrature Amplitude Modulation，正交振幅调制）*，16-QAM每符号产生4比特，64-QAM每符号产生6比特。

![图4. 频谱抽象表示为可调度资源元素的二维网格。](https://upload-images.jianshu.io/upload_images/15825758-9e5f217c33cf29e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

调度器在每1 ms的*TTI（Transmission Time Interval，传输时间间隔）*期间为每个有数据要传输的用户分配一些RE，图4中用不同颜色的块表示不同的用户。调度器必须在7x12=84个RE的块*（PRB，Physical Resource Block，物理资源块）*上做出分配决策，这是它唯一的约束。图4显示了两个连在一起的PRB。当然，时间继续沿着X轴往前流动，根据可用频段的大小（例如，可能是100 MHz宽），可能会有更多的副载波空槽（以及PRB）出现在Y轴上，所以调度器本质上是在准备和发送一系列的PRB。

请注意，OFDMA不是编码/调制算法，而是为每个子载波频率提供一个选择特定编码和调制器的框架。QAM就是一个常见的调制器。调度器的责任是根据它收到的CQI反馈来选择每个PRB使用的调制方式。调度器也在每个PRB的基础上选择编码，例如，如何设置turbo编码算法的参数。

1 ms TTI是调度程序从用户那里接收关于他们正在体验的信号质量反馈的时间段。这就是前面提到的CQI，每个用户每1 ms发送一组指标，调度器使用这些指标来决定如何在随后的TTI期间分配PRB。

调度决策的另一个输入是*QCI（QoS Class Identifier，QoS类标识符）*，它表示每一类流量将要获得的服务质量。在4G中，每个类（总共有9个类）的QCI值表示流量是否具有GBR（Guaranteed Bit Rate，保证比特率）*或者非GBR，以及该QoS类在这两类中的相对优先级。

最后，请记住，图4着重于从单个天线调度传输，但是上面描述的MIMO技术意味着调度程序还必须确定哪个天线（或者更普遍地说，哪个天线子集）将最有效地到达每个接收端。不过还是需要抽象出调度器，负责分配一系列RE。

所有这些都提出了一个问题：调度器如何决定在给定的时间间隔内服务哪一组用户？为每个用户分配多少资源元素？如何选择编码和调制电平？以及在哪个天线上传输数据？这是一个优化问题，不过我们不打算在这里解决这些问题。我们的目标是描述一个允许其他人设计和插入有效调度程序的体系结构。保证蜂窝架构对这类创新的开放是我们的目标之一，正如我们将在下一节中看到的，为调度器操作提供更多的选择将在5G中变得更加重要。

### *5G中的多路复用*
从4G到5G的过渡为无线电频谱调度带来了额外的灵活性，使蜂窝网络能够适应更多样化的设备和应用领域。

本质上，5G定义了一系列波形（waveforms），而LTE只指定了一种波形，每种波形都针对无线电频谱中的不同频段进行了优化<sup>注2</sup>。载波频率低于1GHz的频段旨在提供大部分人关心的移动宽带和大规模物联网服务。1-6 GHz之间的载波频率旨在提供更高的带宽，专注于移动宽带和关键任务应用。24 GHz（mmWaves）以上的载波频率被设计为在视距范围内提供超宽带服务。

> 注2：
> 波形是与信号的频率、振幅和相移无关的特性（形状），正弦波就是一个例子。

这些不同的波形会影响调度和子载波间隔（即前一节中描述的RE的“大小”）。

- 对于sub-1 GHz频段，5G最大允许50 MHz带宽。在这种情况下，有两种波形：一种副载波间距为15 kHz，另一种为30 kHz。(在图4所示的示例中，我们使用了15 kHz。）对应的调度间隔分别为0.5 ms和0.25 ms。（在图4所示的示例中，我们使用了0.5 ms。）
- 对于1-6 GHz频段，最大带宽可达100 MHz。对应的子载波间隔为15、30、60 kHz的三种波形，对应的调度间隔分别为0.5、0.25、0.125 ms。
- 对于毫米波段，带宽可能高达400 MHz。有两种波形，子载波间隔为60 kHz和120 kHz。两者的调度间隔都是0.125 ms。

这些副载波间隔和调度间隔的不同配置有时被称为无线空口的*配置参数（numerology）*。

这个配置参数的范围很重要，因为它为调度器增加了另一个选择。除了向用户分配无线电资源外，它还能够通过改变所使用的波形来动态调整资源的大小。有了这种额外的选项，固定大小的RE不再是资源分配的主要单位。相反，我们使用更抽象的术语，并讨论向用户分配*资源块（Resource Blocks）*，5G调度器决定在每个时间间隔内分配的资源块的大小和数量。

图5从更抽象的角度描述了调度器的角色，与4G一样，来自接收端的CQI反馈和用户选择的QCI服务质量类是调度器输入的两个关键参数。请注意，QCI取值范围在4G和5G是不一样的，这反映了支持的差异化越来越大。对于5G，每个类别包括以下属性：
- 资源类型（Resource Type）：GBR (Guaranteed Bit Rate)、Delay-Critical GBR、Non-GBR
- 优先级水平（Priority Level）
- 包时延冗余（Packet Delay Budget）
- 包错误率（Packet Error Rate）
- 平均窗口（Averaging Window）
- 最大数据量（Maximum Data Burst）

注意，虽然前面的讨论可以解释为用户和QCI之间存在一对一的关系，但更准确的说法是，每个QCI都与一类流量相关联（通常对应于某种类型的应用程序），某个用户可能在任何给定时间发送和接收属于多个类的流量。我们将在后面的章节中更深入地探讨这个概念。

![图5. 调度器根据接收端的CQI反馈以及与每一类服务相关联的QCI参数，将资源块分配给用户数据流。](https://upload-images.jianshu.io/upload_images/15825758-b5f5c444c555d2b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 2.3. New Radio (NR)
最后，我们注意到，虽然前一节将5G描述为在数据传输调度中引入了额外的选择，但最终结果是一个质量上更强大的无线电。这个新的5G空口规范，通常被称为*New Radio（NR）*。它实现了三个新的用例，远远超出了简单的增加带宽的范围：
- eMBB（Extreme Mobile Broadband，超带宽服务）
- uRLLC（Ultra-Reliable Low-Latency Communications，超可靠低延时服务）
- mMTC（Massive Machine-Type Communications，大规模物联网服务）

这三个用例都符合第一章中介绍的需求，都可以归因于5G在无线空口上针对多路数据传输进行的四个基本改进。

第一个改进是前一节中提到的：能够改变波形。这有效地引入了动态更改可调度资源单元的大小和数量的能力，这为制定对可预测、低延迟通信至关重要的细粒度调度决策打开了大门。

第二个改进与“多接入”有关，即不同的流量源如何在可用频谱上进行复用。在4G中，下行流量在频域和时域都进行多路复用（如2.2节所述），而上行流量只在频域进行多路复用。5G NR可在时域和频域都实现上下行业务的复用，这样做可以提供对延迟敏感的应用程序所需的更细粒度的调度控制。

第三个改进与5G NR可用的新频谱有关，24 GHz以上的毫米波尤其重要。这不仅是因为更大的容量——这使得为需要低延迟通信的关键任务应用程序留出专门的容量成为可能——而且因为更高的频率使得更细粒度的资源块（例如，调度间隔短至0.125 ms）成为可能。同时，更低的调度间隔使不能容忍延迟不可预测的应用程序受益。

第四，为大量物联网设备提供移动连接，从需要移动支持的低速设备（如可穿戴设备、资产跟踪器）到支持间歇传输几个字节数据的设备（如传感器、仪表）。这些设备都对延迟不敏感，带宽消耗也比较小，但挑战在于它们需要很长的电池寿命，因此从设计上降低了硬件复杂度，从而消耗更少的能源。

对IoT设备的支持主要围绕将一些可用无线电频谱分配给一个轻量级（简化）空中接口。这种方案从LTE的第13版开始，并通过两种互补的技术：mMTC和NB-IoT（NarrowBand-IoT，窄带物联网）来实现。这两种技术都建立在大大简化的LTE版本上，限制了为更高频谱利用率所需的配置参数和灵活性，从而允许更简单的物联网硬件设计。mMTC提供高达1 Mbps的1.4 MHz带宽，NB-IoT提供几十kbps的超过200 kHz的带宽，因此才有了*窄带（NarrowBand）*这个术语。这两项技术的设计支持每平方公里超过100万个设备。在第16版中，这两种技术都可以在5G频段内运行，但仍基于LTE配置参数。从第17版开始，作为mMTC的演进，将推出更简单的5G NR版本，称为NR-Light，预计NR-Light将进一步提升设备接入密度。

这四个改进的结果是，5G NR旨在支持可用带宽的分区，将不同的分区动态分配给不同类别的流量（例如，高带宽、低延迟和低复杂性）。这就是*切片（slicing）*的本质，我们将在本书中反复讨论这个想法。此外，一旦有不同需求的流量可以由不同的切片提供服务，5G NR的多路复用方法就足以支持针对这些切片提供不同的调度决策，每个切片都为目标流量量身定制。
